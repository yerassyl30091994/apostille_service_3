angular.module("app").directive('fittext', [ '$timeout', '$router', function($timeout, $router) {

    return {
        scope: {
            text: '@'
        },
        replace: true,
        restrict: 'E',
        template: '<div class="textContainer" ng-style="{ fontSize: fontSize }" ng-bind="text"></div>',
        controller: function($scope, $element) {

//            var resizeText = function(){
//
//                var minFontSize = parseInt($scope.minFontSize) || 8,
//                    textContainer = $element[0],
//                    maxHeight = $element.parent()[0].offsetHeight,
//                    maxWidth = $element.parent()[0].offsetWidth,
//                    textHeight, textWidth;
//                var fontSize = parseInt(textContainer.style.fontSize) || 24;
//                angular.element(textContainer).css('word-wrap', 'break-word');
//
//                do {
//                    textHeight = textContainer.offsetHeight;
//                    textWidth = textContainer.offsetWidth;
//                    var ratio = _.min([maxWidth/textWidth, maxHeight/textHeight]);
//                    fontSize = fontSize * Math.sqrt(ratio) + 'px';
//                    textContainer.style.fontSize = fontSize;
//                } while (
//                    textHeight >= maxHeight && textWidth >= maxWidth && fontSize >= minFontSize
//                    );
//            };

            $scope.$watch('text', function(newText, oldText){
                if(!newText) return;
                if(oldText !== undefined && newText.length < oldText.length){
                    fontSize = 24;
                }
                //$timeout(resizeText);

                if($element[0].id == 'categorySize'){
                    $element[0].style.fontSize = parseInt($router.getGroupTitleSize()) + 'px';
                }else {
                    $element[0].style.fontSize = parseFloat($router.getLocation('declaration').get().titleSize) + 'rem';
                }
                angular.element($element[0]).css('word-wrap', 'break-word');
            });
        }
    };
}]);
