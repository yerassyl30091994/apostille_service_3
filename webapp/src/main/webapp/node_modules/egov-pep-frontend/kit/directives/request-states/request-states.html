<div class="declaration-state" ng-init="$declaration = $root.$declaration; $session = $session;$modal = $root.$modal; $locales = $root.$locales">
  <eds namespace="agreement"></eds>

  <div ng-show="!agreementSigningActive" ng-if="$declaration.state">

    <!-- <div class="service-common" ng-if="$declaration.model.groupAgreement">-->
    <div class="service-common" ng-if="allowAgreementMembers()">
      <header class="title" ng-if="agreementMembers.length > 0">{{ 'agreement.title' | translate }}</header>
      <table class="decorated-table bordered">
        <tr>
          <th>{{'govProfile.fio' | translate}}/{{'govProfile.nameOrganization' | translate}}</th>
          <th>{{'govProfile.iin' | translate}}/{{'govProfile.bin' | translate}}</th>
          <th>{{'status.currentState' | translate}}</th>
        </tr>
        <tr ng-repeat="member in agreementMembers">
          <td>{{member.name}}</td>
          <td>{{member.iin}}</td>
          <td ng-if="!canAgree(member.iin) && (member.status === 'APPROVED')">{{ 'agreement.agreed'   | translate }}</td>
          <td ng-if="!canAgree(member.iin) && (member.status === 'CANCELED')">{{ 'agreement.declined' | translate }}</td>
          <td ng-if="!canAgree(member.iin) && (member.status === 'OVERDUE' )">{{ 'agreement.overdue'  | translate }}</td>
          <td ng-if="!canAgree(member.iin) && !member.signed">{{ 'agreement.waiting' | translate }}</td>
          <td ng-if="canAgree(member.iin)">
            <a class="button-type button-action" ng-click="agree('APPROVED')">
              {{ 'agreement.agree' | translate }}
            </a>
            <br />
            <br />
            <a class="button-type button-action pep-red" ng-click="agree('CANCELED')">
              {{ 'agreement.decline' | translate }}
            </a>
          </td>
        </tr>
      </table>
    </div>

<!--
    $declaration.isApprover=true если авторизованный это согласующий то тогда все скрывается кроме таблицы согласующих,
    вызывается по ресту rest/app/isApprover?requestNumber= смотреть в 61-04.
    В остальных случаях должен показывать.
-->
    <div data-ng-hide="$declaration.isApprover">
      <section class="service-common">

        <header class="title">{{ 'status.title' | translate }}</header>

        <article>

          <table class="decorated-table">
            <tbody>
            <!--убираем, так как на малый ПОД не влезает :(-->
            <!--<tr ng-if="$declaration.state.operatorIin">
                            <td>{{ 'operatoruin' | translate }}</td>
                            <td>{{ $declaration.state.operatorIin }}</td>
                        </tr>
                        <tr ng-if="$declaration.state.operatorName">
                            <td>{{ 'operatorname' | translate }}</td>
                            <td>{{ $declaration.state.operatorName}}</td>
                        </tr>-->

            <tr ng-if="$declaration.state.declarantIdentificationNumber">
              <td>{{ getDeclarantIdKey() | translate }}</td>
              <td>{{ $declaration.state.declarantIdentificationNumber }}</td>
            </tr>
            <tr ng-if="$declaration.state.declarantName">
              <td>{{ getDeclarantNameKey() | translate }}</td>
              <td>{{ $declaration.state.declarantName }}</td>
            </tr>

            <tr ng-if="$declaration.state.recipientUin && ($declaration.state.declarantIdentificationNumber != $declaration.state.recipientUin)">
              <td>{{ getRecipientIdKey() | translate }}</td>
              <td>{{$declaration.state.recipientUin }}</td>
            </tr>
            <tr ng-if="$declaration.state.recipientFullName && ($declaration.state.declarantIdentificationNumber != $declaration.state.recipientUin)">
              <td>{{ getRecipientNameKey() | translate }}</td>
              <td>{{$declaration.state.recipientFullName}}</td>
            </tr>

            <tr>
              <td>{{ 'status.rqNum' | translate }}</td>
              <td>{{$declaration.requestId}}</td>
            </tr>
            <tr>
              <td>{{ 'status.rqDate' | translate }}</td>
              <td>{{ ( $declaration.state.appCreationDate | date: 'dd.MM.yyyy HH:mm:ss' ) || '' }}</td>
            </tr>
            <tr>
              <td>{{ 'status.estimate' | translate }}</td>
              <td>{{ 'status.estimates.' + $router.getActiveLocation().get().estimate | translate }}</td>
            </tr>

            </tbody>
          </table>

          <div class="status" ng-if="$settings.isPod()">
            {{ 'status.status' | translate }} &mdash;
            <img ng-if="$declaration.state.status=='APPROVED' && !$settings.isContrast()" ng-src="kit/_styles/images/icons/icon-status-ok-animated.gif" alt="">
            <span ng-if="$declaration.state.status=='APPROVED' && $settings.isContrast()" class="font-icon icon-status-ok"></span>

            <img ng-if="($declaration.state.status=='SENDING' ||
                         $declaration.state.status=='IN_PROCESSING' ||
                         $declaration.state.status=='IN_QUEUE' ||
                         $declaration.state.status=='PREPARING_REQUEST' ||
                         $declaration.state.status=='ACCEPTED') &&
                         !$settings.isContrast()"
                  ng-src="kit/_styles/images/icons/clock-animated.gif" alt="">
            <span ng-if="($declaration.state.status=='SENDING' ||
                          $declaration.state.status=='IN_PROCESSING' ||
                          $declaration.state.status=='IN_QUEUE' ||
                          $declaration.state.status=='PREPARING_REQUEST' ||
                          $declaration.state.status=='ACCEPTED') &&
                          $settings.isContrast()"
                  class="font-icon icon-status-wait"></span>

            <img ng-if="($declaration.state.status=='DECLINED' ||
                         $declaration.state.status=='REJECTED' ||
                         $declaration.state.status=='CANCELED' ||
                         $declaration.state.status=='TIME_OUT_PAY_ORDER') &&
                         !$settings.isContrast()"
                  ng-src="kit/_styles/images/icons/icon-status-fail-animated.gif" alt="">
            <span ng-if="($declaration.state.status=='DECLINED' ||
                          $declaration.state.status=='REJECTED' ||
                          $declaration.state.status=='CANCELED' ||
                          $declaration.state.status=='TIME_OUT_PAY_ORDER') &&
                          $settings.isContrast()"
                  class="font-icon icon-status-fail"></span>

            <img ng-if="$declaration.state.status=='TECH_ERROR' && !$settings.isContrast()" ng-src="kit/_styles/images/icons/icon-status-warning-animated.gif" alt="">
            <span ng-if="$declaration.state.status=='TECH_ERROR' && $settings.isContrast()" class="font-icon icon-status-warning"></span>
            {{ ('status.state.' + $declaration.state.status) | translate }}
          </div>

          <div class="status" ng-if="!$settings.isPod()">
              <div class="status-first">{{ 'status.status' | translate }}</div>
            <span ng-if="$declaration.state.status=='APPROVED' && $settings.isContrast()" class="font-icon icon-status-ok"></span>
            <span ng-if="($declaration.state.status=='SENDING' ||
                          $declaration.state.status=='IN_PROCESSING' ||
                          $declaration.state.status=='IN_QUEUE' ||
                          $declaration.state.status=='PREPARING_REQUEST' ||
                          $declaration.state.status=='ACCEPTED') &&
                          $settings.isContrast()"
                  class="font-icon icon-status-wait"></span>
            <span ng-if="($declaration.state.status=='DECLINED' ||
                          $declaration.state.status=='REJECTED' ||
                          $declaration.state.status=='CANCELED' ||
                          $declaration.state.status=='TIME_OUT_PAY_ORDER') &&
                          $settings.isContrast()"
                  class="font-icon icon-status-fail"></span>
            <span ng-if="$declaration.state.status=='TECH_ERROR' && $settings.isContrast()" class="font-icon icon-status-warning"></span>
            <div class="status-second">{{ ('status.state.' + $declaration.state.status) | translate }}</div>
          </div>

          <div style="padding:10px;font-size:1.2rem;padding-left:0" ng-show="!!getGoStatus()"
                ng-if="$declaration.state.statusGo.code === 'DECLINED' ||
                       $declaration.state.statusGo.code === 'REJECTED' ||
                       $declaration.state.statusGo.code === 'IISCON_FINISHED_REJECTION' ||
                       $declaration.state.statusGo.code === 'IISCON_CANCELLED' ||
                       $declaration.state.statusGo.code === 'IISCON_HANDED' ||
                       $declaration.state.statusGo.code === 'IISCON_READY' ||
                       $declaration.state.statusGo.code === 'TECH_ERROR' ||
                       $declaration.state.statusGo.code === 'CANCELLED' ||
                       $declaration.state.status === 'TIME_OUT_PAY_ORDER' ||
                       $declaration.state.status === 'NOT_PAID'">
            {{'cause' | translate }}: {{ getGoStatus() }}
          </div>
          <!------------------------Ожидание оплаты и кнопка для перехода на ПШЭП-------------------------------->
          <div class="mt30 pr80" ng-if="$declaration.state.status === 'WAITING_FOR_PAYMENT' && $declaration.state.paymentInformation.paymentUrl">
            {{ 'status.payInfoWait' | translate }}
            <br/>
            <br/>
            <button class="button-type button-subaction" ng-click="pay();" id="pay">
              {{ 'status.pay' | translate }}
            </button>
              <br/>
              <br/>
            {{ 'status.payInfoPay' | translate }}
            <br/>
          </div>
          <!--------------------------------------Конец-------------------------------->
          <!------------------------Ожидание оплаты и кнопка для перехода на шаг оплаты-------------------------------->
          <div class="mt30 pr80" ng-if="$declaration.state.status === 'GO_TO_PAYMENT_STEP'">
            {{ 'status.payInfoWait' | translate }}
            <br/>
            <br/>
            <button class="button-type button-subaction fl-r ml10" ng-click="goToPayStep();" id="goToPayStep">
              {{ 'status.pay' | translate }}
            </button>
            {{ 'status.payInfoPay' | translate }}
            <br/>
          </div>
          <!--------------------------------------Конец-------------------------------->
        </article>

      </section>


      <div ng-if="$declaration.state.resultsForDownload">
        <div class="results" ng-if="($declaration.state.resultsForDownload.length > 0) && $settings.isPod()">
          <a href="#" ng-click="$modal.show('declarationResults'); $root.currentDocument = result;" ng-repeat="result in $declaration.state.resultsForDownload">
            <table>
              <tr>
                <td>
                  <img data-ng-if="!$settings.isContrast()" ng-src="kit/_styles/images/icons/icon-pdf-small.png" alt="pdf">
                  <div data-ng-if="$settings.isContrast()" class="contrast-pdf">PDF</div>
                </td>
                <td>
                  <div ng-if="$locales.current() === 'ru'" class="width-result-pdf"> {{ result.nameRu }}</div>
                  <div ng-if="$locales.current() === 'kz'" class="width-result-pdf"> {{ result.nameKk }}</div>
                  <div ng-if="$locales.current() === 'en'" class="width-result-pdf"> {{ result.nameEn }}</div>
                </td>
              </tr>
            </table>
          </a>
        </div>
        <div class="results" ng-if="($declaration.state.resultsForDownload.length > 0) && $settings.isPep()">
          <a href="{{result.url}}" ng-repeat="result in $declaration.state.resultsForDownload" target="_blank">
            <table>
              <tr>
                <td>
                  <img ng-src="kit/_styles/images/pep/document.png" alt="pdf">
                </td>
                <td>
                  <div ng-if="$locales.current() === 'ru'" class="width-result-pdf"> {{ result.nameRu }}</div>
                  <div ng-if="$locales.current() === 'kz'" class="width-result-pdf"> {{ result.nameKk }}</div>
                  <div ng-if="$locales.current() === 'en'" class="width-result-pdf"> {{ result.nameEn }}</div>
                </td>
              </tr>
            </table>
          </a>
        </div>
        </td>
      </div>
          <form name="emailForm" ng-if="mail.show && $settings.isPod()">
            <button ng-show="$declaration.state.status === 'APPROVED'" id="mailSenderBtn" class="button-type button-action" ng-click="sendMailClick()">{{'status.pdf.sendToEmail' | translate}}</button>
            <br/>
            <br/>
            <div ng-if="mail.visible">
        <input id="email" name="email" type="email" ng-model="mail.address" class="input-type" required="true"/>
            <br/>
            <br/>
        <button ng-disabled="!emailForm.email.$valid " id="sendMailButton" class="button-type button-action" ng-click="sendToMail()">{{'status.pdf.send' | translate}}</button>
        <tr ng-show="mail.send !== 'null'">
            <div class="dots" ng-if="mail.send===true">
              <span nf-if="" class="field"> {{ 'status.pdf.sent' | translate }}</span>
            </div>
          <div class="dots" ng-if="mail.send===false">
            <span nf-if="" class="error"> {{ 'status.pdf.notSent' | translate }}</span>
          </div>
        </tr>
      </div>
        </form>

      <div class="government-worker" ng-if="$declaration.state.status!='CREATED' && $declaration.state.status!='SENDING' && $declaration.state.status!='IN_PROCESSING' && $declaration.state.status!='PREPARING_REQUEST' && $declaration.state.status!='ACCEPTED' && $declaration.state.status!='TECH_ERROR'">
          <!--Потребовали чтобы кнопка в статусной странице имела другое название, сделал только для услуги K10.09-->
          <a class="link-extended" href="#" ng-if="$declaration.state.eds.iin && checkK1009()==false" ng-click="$modal.show('govWorkerInfo');">
          <span>{{ 'govProfile.showGovWorkerDetails' | translate}}</span>
        </a>
          <a class="link-extended" href="#" ng-if="$declaration.state.eds.iin && checkK1009()==true" ng-click="$modal.show('govWorkerInfo');" >
              <span>{{ 'govProfile.showGovWorkerDetails2' | translate}}</span>
          </a>

        <modal class="gov-worker-info" data-ng-title="govProfile.govWorkerDetails" name="govWorkerInfo">

          <div>
            <div class="leaders">
              <table>
                <tbody>
                <tr ng-show="$declaration.state.eds.iin && $declaration.state.eds.iin !== 'null' ">
                  <td>
                    <div class="dots">
                      <span class="field">{{ 'govProfile.iin' | translate }}</span>
                    </div>
                  </td>
                  <td colspan="2">{{ $declaration.state.eds.iin }}</td>
                </tr>
                <tr ng-show="$declaration.state.eds.fullName && $declaration.state.eds.fullName !== 'null'">
                  <td>
                    <div class="dots">
                      <span class="field"> {{ 'govProfile.fio' | translate }}</span>
                    </div>
                  </td>
                  <td colspan="2">{{ $declaration.state.eds.fullName }}</td>
                </tr>
                <tr ng-show="$declaration.state.eds.bin && $declaration.state.eds.bin !== 'null'">
                  <td>
                    <div class="dots">
                      <span class="field"> {{ 'govProfile.bin' | translate }}</span>
                    </div>
                  </td>
                  <td colspan="2">{{ $declaration.state.eds.bin }}</td>
                </tr>
                <tr ng-show="$declaration.state.eds.organization && $declaration.state.eds.organization !== 'null'">
                  <td>
                    <div class="dots">
                      <span class="field"> {{ 'govProfile.nameOrganization' | translate }}</span>
                    </div>
                  </td>
                  <td colspan="2">{{ $declaration.state.eds.organization }}</td>
                </tr>
                <tr ng-show="$declaration.state.eds.createdDate && $declaration.state.eds.createdDate !== 'null'">
                  <td>
                    <div class="dots">
                      <span class="field"> {{ 'govProfile.dateCertStart' | translate }}</span>
                    </div>
                  </td>
                  <td colspan="2">{{ $declaration.state.eds.createdDate | date: 'dd.MM.yyyy' }}</td>
                </tr>
                <tr ng-show="$declaration.state.eds.endedDate && $declaration.state.eds.endedDate !== 'null'">
                  <td>
                    <div class="dots">
                      <span class="field"> {{ 'govProfile.dateCertEnd' | translate }}</span>
                    </div>
                  </td>
                  <td colspan="2">{{ $declaration.state.eds.endedDate | date: 'dd.MM.yyyy' }}</td>
                </tr>
                <tr ng-show="$declaration.state.eds.issuer && $declaration.state.eds.issuer !== 'null'">
                  <td>
                    <div class="dots">
                      <span class="field"> {{ 'govProfile.givenOrganisation' | translate }}</span>
                    </div>
                  </td>
                  <td colspan="2">{{ $declaration.state.eds.issuer }}</td>
                </tr>
                <tr ng-show="$declaration.state.eds.status && $declaration.state.eds.status !== 'null'">
                  <td>
                    <div class="dots">
                      <span class="field"> {{ 'govProfile.certStatus' | translate }}</span>
                    </div>
                  </td>
                  <td colspan="2">{{ 'profile.certStatuses.' + $declaration.state.eds.status | translate }}</td>
                </tr>
                </tbody>
              </table>
              <br>
            </div>
          </div>
        </modal>
      </div>
    </div>
      <div ng-transclude></div>
    <div data-ng-hide="$declaration.isApprover">
      <div class="actions-pad" ng-if="$settings.isPod()">
        <table>
          <tr>
            <td class="td-left">
              <button class="button-type button-action button-update" id="refresh"
                      ng-click="refresh()"
                      ng-if="$declaration.refreshIsAllowed()" ng-disabled="norefresh">{{ 'status.refresh' | translate }}</button>
              <button class="button-type button-subaction button-subaction-next" id="restart"
                      ng-click="restart();"
                      ng-if="$declaration.restartIsAllowed()">{{ 'status.restart' | translate }}</button>
            </td>
            <td class="td-right">
              <button class="button-type button-subaction" target="_self" href="" id="finish" ng-if="buttons['finish'].show" ng-click="buttons['finish'].active = false; bye()" ng-disabled="!buttons['finish'].active">
                {{ 'status.cancel' | translate }}
              </button>
              <button class="button-type button-action button-update" id="resend" ng-click="resend()" ng-if="$declaration.state.status==='SENT_SHEP_ERROR' && $declaration.state.declarantIdentificationNumber == $root.$session.uin">
                {{ 'status.resend' | translate }}
              </button>
            </td>
          </tr>
        </table>
      </div>

      <div class="actions-pad" ng-if="!$settings.isPod()">
        <table style="width: 700px">
          <tr>
            <td class="td-left">
              <button class="button-type button-action button-update" id="refresh"
                      ng-click="refresh()"
                      ng-if="$declaration.refreshIsAllowed()" ng-disabled="norefresh">{{ 'status.refresh' | translate }}</button>
            </td>
            <td class="td-right">
              <button class="button-type button-subaction button-subaction-next" id="restart"
                      ng-click="restart();"
                      ng-if="$declaration.restartIsAllowed()">{{ 'status.restart' | translate }}</button>
            </td>
          </tr>
          <tr>
            <td class="td-left">
              <button class="button-type button-subaction" target="_self" href="" id="finish" ng-if="buttons['finish'].show" ng-click="buttons['finish'].active = false; bye()" ng-disabled="!buttons['finish'].active">
                {{ 'status.cancel' | translate }}
              </button>
            </td>
            <td class="td-right">
              <button class="button-type button-action button-update" id="resend" ng-click="resend()" ng-if="$declaration.state.status==='SENT_SHEP_ERROR' && $declaration.state.declarantIdentificationNumber == $root.$session.uin">
                {{ 'status.resend' | translate }}
              </button>
            </td>
          </tr>
        </table>
      </div>

      <div class="invisible-button" ng-if="$declaration.model.needInvisibleButton">
        <button class="invisible" ng-click="changeRequestNumber()">" "</button>
      </div>

    </div>

    <modal name="declarationResults" data-ng-title="" noscroll="true">
      <div ng-if="!!$root.$session.operator" class="pdf-frame-name">
        <a href="#" ng-click="$root.currentDocument = result;" ng-repeat="result in $declaration.state.resultsForDownload | filter:{ language: $root.$locales.current()}">
          <span class="pdf-frame-text">{{result.name}}</span>
        </a>
      </div>
      <iframe class="pdf-frame" id="printf" name="printf" src="{{$sce.trustAsResourceUrl($root.currentDocument.url)}}" frameborder="0" type="application/pdf" egov-window-height="force"></iframe>
    </modal>

  </div>
</div>
