angular.module("app").directive("settings", ["$settings", 'functionalTestService', function ($settings, functionalTestService) {
    return {
        restrict: "E",
        scope: true,
        replace: true,
        templateUrl: "kit/directives/settings/settings-template.html",
        controller: function ($scope, $element) {
            $scope.buttons = [
                { "name": "Сменить режим", "param": "egov-client-type", "active": false },
                { "name": "Отключить звук", "param": "egov-mute", "active": false },
                { "name": "Выключить клавиатуру", "param": "egov-forcehwkeybd", "active": false },
                { "name": "Fake REST", "param": "egov-stubbedrest", "active": false },
                { "name": "Fake delay", "param": "egov-slomo", "active": false },
                { "name": "Подсказки", "param": "egov-testhints", "active": false }
            ];

            $scope.toggleParam = function (param, index) {
                $settings.toggleParam(param);
                if (button.param != "egov-client-type") {
                    $scope.buttons[index].active = $settings.getParam(param);
                    $scope.apply();
                }
            };

            $scope.showHints = function () {
                return $settings.getParam("egov-testhints");
            };

            _.each($scope.buttons, function (button, index) {
                if (button.param != "egov-client-type") {
                    $scope.buttons[index].active = $settings.getParam(button.param);
                }
            });
        },
        link: function (scope) {
            scope.functionalTestService = functionalTestService;
        }
    }
}]);