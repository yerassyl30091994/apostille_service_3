angular.module("app").service('egovOTPservice', ['$http', 'signDefaults',
    function ($http, signDefaults) {
        this.url = "rest/app/send-otp";

        this.checkRegMBC = function (app, iin) { /*Проверяем зарегистрирован ли пользователь в МБГ*/
            return $http.get(app + 'rest/mcdb/user-phone?uin=' + iin,{});
        };

        this.setValidateCallBack = function (validateCallBack) {
            this.validateCallBack = validateCallBack;
        };

        this.newCode = function (app, iin) { /*Отправляем СМС*/
            return $http.post(app + 'rest/otp/generate?uin=' + iin,{});
        };
        this.sendCode = function (app, code, iin, data, parent, captchaCode) {
            var uin = iin ? '&uin=' + iin : ''; //Для ПОДа, когда вводим ИИН, передаем его как параметр
            var url = app + this.url + '?code=' + code + uin;
            if(parent) url += '&parentRequestNumber=' + parent;
            if(captchaCode) url += '&captchaCode=' + captchaCode; // Для captcha
            return $http({ url: url,  method: "POST", data: data, headers: {'Content-Type': 'application/json'} });
        };
        this.getDefaults = function(app){ // crap
            if(app in signDefaults) return signDefaults[app];
            else return false;
        };
        this.initApp = function(app){
            if(app) return document.location.origin + '/services/' + app + '/';
            //if(app) return app + '/';
            return '';
        };

        this.setUrl = function(url){
            this.url = url;
        };

        return this;
    }]);
